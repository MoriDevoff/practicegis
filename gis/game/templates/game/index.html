{% extends 'base.html' %}
{% load static %}
{% block title %}GeoGame - Главная{% endblock %}
{% block content %}
<div class="game-container" data-is-authenticated="{{ user.is_authenticated|lower }}">
    <h1 class="game-title">Добро пожаловать в GeoGame!</h1>
    <p class="game-description">Испытайте свои знания географии в увлекательной игре, где вы сможете соревноваться с другими игроками или играть в одиночку.</p>

    <div class="instruction-section">
        <h2>Как играть в GeoGame?</h2>
        <div class="instruction-steps">
            <div class="step">
                <img src="{% static 'images/instructions/step1.png' %}" alt="Шаг 1: Получите изображение">
                <p>1. Вы получаете изображение известного места.</p>
            </div>
            <div class="step">
                <img src="{% static 'images/instructions/step2.png' %}" alt="Шаг 2: Отметьте на карте">
                <p>2. На карте мира выберите точку, где, по вашему мнению, находится это место.</p>
            </div>
            <div class="step">
                <img src="{% static 'images/instructions/step3.png' %}" alt="Шаг 3: Получите очки">
                <p>3. Чем ближе вы к цели, тем больше очков вы получите!</p>
            </div>
        </div>
    </div>

    {% if user.is_authenticated %}

        <div class="centered-game-actions">
            <form method="post" action="{% url 'online_matchmaking' %}" class="action-form">
                {% csrf_token %}
                <button type="submit" class="game-button">
                    <i class="fas fa-users"></i>
                    Найти соперника
                </button>
            </form>

            <a href="{% url 'solo_play' %}" class="game-button">
                <i class="fas fa-gamepad"></i>
                Играть в одиночку
            </a>
        </div>
    {% else %}
        <div class="centered-game-actions">
            <a href="{% url 'login' %}" class="game-button">
                <i class="fas fa-sign-in-alt"></i>
                Войти
            </a>
            <a href="{% url 'solo_play' %}" class="game-button">
                <i class="fas fa-gamepad"></i>
                Играть в одиночку
            </a>
            <a href="{% url 'register' %}" class="game-button">
                <i class="fas fa-user-plus"></i>
                Регистрация
            </a>
        </div>
    {% endif %}

    <div id="waitingMessage" class="waiting-message" style="display: none;">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Ожидание соперника...</p>
    </div>

    <div id="battleReadyContainer" style="display:none; text-align:center; margin-top:20px;">
        <a id="battleReadyBtn" href="#" class="game-button" style="background:#2196F3; color:white;">Перейти к сражению</a>
    </div>
</div>

<style>
.instruction-section {
    margin-top: 2rem;
    margin-bottom: 2rem;
    text-align: center;
}

.instruction-section h2 {
    color: var(--primary-color);
    margin-bottom: 1.5rem;
    font-size: 1.8rem;
}

.instruction-steps {
    display: flex;
    justify-content: center;
    gap: 2rem;
    flex-wrap: wrap;
}

.step {
    flex: 1;
    min-width: 250px;
    max-width: 300px;
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 8px;
    box-shadow: var(--shadow);
    padding: 1.5rem;
    text-align: center;
}

.step img {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
    margin-bottom: 1rem;
    border: 1px solid var(--light-gray);
}

.step p {
    color: var(--text-color);
    font-size: 1.1rem;
}

.centered-game-actions {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    margin-top: 2rem;
    flex-wrap: wrap;
}

.welcome-message {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
    padding: 1rem;
    background-color: var(--light-gray);
    border-radius: 4px;
}

.welcome-message i {
    font-size: 2rem;
    color: var(--secondary-color);
}

.waiting-message {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 2rem;
    padding: 1rem;
    background-color: var(--light-gray);
    border-radius: 4px;
    color: var(--primary-color);
}

.waiting-message i {
    font-size: 1.5rem;
    color: var(--secondary-color);
}

@media (max-width: 768px) {
    .instruction-steps {
        flex-direction: column;
        align-items: center;
    }

    .step {
        width: 90%;
    }

    .centered-game-actions {
        flex-direction: column;
        align-items: center;
    }
}
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const gameContainer = document.querySelector('.game-container');
        const isAuthenticated = gameContainer.dataset.is_authenticated === 'true';
        const waitingMessage = document.getElementById('waitingMessage');

        if (isAuthenticated) {
            document.querySelector('.action-form').addEventListener('submit', function(e) {
                e.preventDefault();
                waitingMessage.style.display = 'flex';
                this.submit();
            });
        }
    });
</script>
{% endblock %}